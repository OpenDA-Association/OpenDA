# Lahey Makefile for library - adwdm
#
# Last modified:  01/10/10  mcrouse

# Usage:  make [libdir=path_to_install_to] [install] [> compile.out]
#
# Examples:  make
#            make install libdir=C:\lib
#            make install libdir=C:\my_dir\lib

FFLAGS  = $(OptM) $(ImpF)       # compile options (OptM or DbgF) + ImpF
FC      = lf90                  # compiler
AR      = 386lib                # library archiver

#*******************************************************************
#*****   Some things may need to be changed below this line.   *****
#*******************************************************************

# Compiler flags
# -ap    - arithmetic precision; guarantee consistency of REAL, COMPLEX calc.s
# -chk   - check substring and array subscript bounds, argument types;
#          generates fatal runtime error; removes optimization by forcing -o0
# -g     - generate source level symbolic debug information
# -nhed  - generate direct files w/o headers
# -in    - no implicit typing in effect, as if IMPLICIT NONE statement in code
# -nin   - Fortran implicit typing in effect
# -o3    - perform production code optimizations
# -tp    - code optimized for target processor Intel Pentium
# -trace - generate call traceback with runtime error messages
# -trap  - trap NDP exceptions:  d=divide by 0, i=invalid operation,
#          o=overflow, u=underflow
# -xref  - include cross-reference information in listing file
# (NOTES: to generate debug code - set FFLAGS to Dbgf
#            for production code - set FFLAGS to OptM
DbgF = -ap -chk -g -nhed -tp -trace -trap diou -xref
OptM = -ap -nhed -o3 -tp -trace -trap diou
ImpF = -in

# Object files, installation specific
# where usys[pc lh lf90 ot].obj
#       ehut[lh lf90 ot].obj
#       wdoppc.obj
ObjLahey77 = usyslh.obj ehutlh.obj wdoppc.obj
ObjLahey90 = usyslf90.obj ehutlf90.obj wdoppc.obj
ObjOtg     = usysot.obj ehutot.obj wdoppc.obj
ObjGeneric = usyspc.obj wdoppc.obj
ObjVrsn    = $(ObjLahey90)

#*******************************************************************
#***** You should not need to modify anything below this line. *****
#*******************************************************************

library = adwdm.lib
Objects = utwdmd.obj utwdmf.obj utwdt1.obj wdmess.obj wdatm1.obj \
          msimpt.obj msexpt.obj msopen.obj prtfil.obj ztwdmf.obj \
          adutil.obj wdmchk.obj

libdir  = ..\..\lib
binary  = ..\..\lib
libMake = $(binary)\$(library)
libInst = $(libdir)\$(library)

# Rules
all: $(binary) $(libMake) install
	@echo
	@echo Done making all for adwdm, files are now up-to-date.
	@echo

# Library and utility dependencies:
$(libMake):   $(Objects) $(ObjVrsn)
	@echo
	@echo making $(libMake)
	$(AR) $@ -replace $?
$(binary):
	!if ! -d $(binary)
	   @mkdir $(binary)
	   @echo Created directory $(binary)
	!endif
install:
# Create directory for binary file, if necessary
	!if ! -d $(libdir)
	   @mkdir $(libdir)
	   @echo Created directory $(libdir)
	!endif
# Link executable to libdir if installing elsewhere
	!if (! -e $(libMake)) || (-z $(libMake))
	   @echo library $(libMake) does not exist,
	   @echo use one of the following commands to generate it:
	   @echo      make
	   @echo      make all
	!else
	   !if $(libdir) != $(binary)
	      !if -e $(libInst)
	         @del $(libInst)
	      !endif
	      @(cd ..\..; copy lib\$(library) $(libInst))
	      @echo
	      @echo Library $(libInst) has been updated.
	   !endif
	!endif
clean:
	!if $(libdir) != $(binary)
	   !if -e $(libInst)
	      @del $(libInst)
	   !endif
	!endif
	!if -e *.obj
	   @del *.obj
	!endif
	!if -e $(libMake)
	   @del $(libMake)
	!endif
	@echo Removed files generated by make.
	@echo

# Define object file dependencies:
adutil.obj: czglvl.inc zcntrl.inc pmxrsl.inc
ehutlf90.obj: color.inc  cqrsp.inc  cscren.inc pmxfld.inc zcntrl.inc
ehutlh.obj: color.inc  cqrsp.inc  cscren.inc pmxfld.inc zcntrl.inc
ehutot.obj: cqrsp.inc  cscren.inc pmxfld.inc zcntrl.inc
msimpt.obj: pmxfld.inc
msopen.obj: fmsgwd.inc
utwdmd.obj: cfbuff.inc cdrloc.inc fversn.inc
utwdmf.obj: cfbuff.inc
wdatm1.obj: cfbuff.inc cdrloc.inc
wdmchk.obj: cfbuff.inc cdrloc.inc fmsgwd.inc
wdmess.obj: cfbuff.inc cdrloc.inc
ztwdmf.obj: cfbuff.inc cqrsp.inc  cscren.inc czhide.inc czoptn.inc \
            cclbak.inc pmxfld.inc zcntrl.inc pmxrsl.inc

# end of make
