subroutine model_end

use global
use model_extra_global

implicit none

!{GEOSR, OIL, CWCHO, 101122
IF(ISPD.GE.2.AND.IDTOX.LT.4440) CLOSE(ULGR)  !DHC
!}


! *** EE BEGIN BLOCK


! **  OUTPUT TIMING (OUTPUT TO TIME.LOG (UNIT 9) USED BY EFDC_EXPLORER)
CALL CPU_TIME(TIME_END)
TIME_END=TIME_END/3600.


! **  DTIME AND FLUSH ARE SUPPORTED ON SUN SYSTEMS,BUT MAY NOT BE
! **  SUPPORTED ON OTHER SYSTEMS.
call DTIME(CPUTIME,TCPU)
!TCPU=DTIME(CPUTIME)
TCPU=TCPU/3600
CPUTIME(1)=CPUTIME(1)/3600.  !TCPU
CPUTIME(2)=CPUTIME(2)/3600.
TCONG=TCONG/3600.
THDMT=THDMT/3600.
TPUV =TPUV/3600.
TSSED=TSSED/3600.
TSSEDZLJ=TSSEDZLJ/3600.
TCEXP=TCEXP/3600.
TAVB =TAVB/3600.
TUVW =TUVW/3600.
TQQQ =TQQQ/3600.
TVDIF=TVDIF/3600.
TSADV=TSADV/3600.
TLRPD=TLRPD/3600.
TMISC=TMISC/3600.
TWQADV=TWQADV/3600.
TWQDIF=TWQDIF/3600.
TWQKIN=TWQKIN/3600.
TWQSED=TWQSED/3600.
WRITE(6,1995)THDMT,TCONG
IF( NSEDFLUME==0 )THEN
   WRITE(6,1996)TPUV,TSSED
ELSE
   WRITE(6,2005)TPUV,TSSEDZLJ
ENDIF
WRITE(6,1997)TCEXP,TAVB
WRITE(6,1998)TUVW,TQQQ
WRITE(6,1999)TVDIF,TSADV
WRITE(6,2000)TLRPD,TMISC
IF(ISTRAN(8).GT.0)THEN
   WRITE(6,2001)TWQADV,TWQDIF
   WRITE(6,2002)TWQKIN,TWQSED
ENDIF
WRITE(6,2003)CPUTIME(1),CPUTIME(2)
WRITE(6,2004)TIME_END,  TCPU
1995 FORMAT('***TIMING (HOURS)',/, &
          'T HDMT      =',F7.3,'  T CONG GRAD =',F7.3)
1996 FORMAT('T P&UV VELS =',F7.3,'  T SSEDTOX   =',F7.3)
1997 FORMAT('T EXPLICIT  =',F7.3,'  T C VERT V&D=',F7.3)
1998 FORMAT('T CALC UVW  =',F7.3,'  T TURB QQQ  =',F7.3)
1999 FORMAT('T VERT DFUSN=',F7.3,'  T ADV TRANSP=',F7.3)
2000 FORMAT('T PART TRK  =',F7.3,'  T MISC TIME =',F7.3)
2001 FORMAT('WQ ADV TRANS=',F7.3,'  WQ VERT DIFF=',F7.3)
2002 FORMAT('WQ KINETICS =',F7.3,'  WQ DIAGEN   =',F7.3)
2003 FORMAT('CPU USER    =',F7.3,'  CPU SYSTEM  =',F7.3)
2004 FORMAT('ELAPSED TIME=',F7.3,'  CPU TIME    =',F7.3)
2005 FORMAT('T P&UV VELS =',F7.3,'  T SEDZLJ    =',F7.3)

! *** EFDC LOG
WRITE(8,1995)THDMT,TCONG
IF( NSEDFLUME==0 )THEN
   WRITE(8,1996)TPUV,TSSED
ELSE
   WRITE(8,2005)TPUV,TSSEDZLJ
ENDIF
WRITE(8,1997)TCEXP,TAVB
WRITE(8,1998)TUVW,TQQQ
WRITE(8,1999)TVDIF,TSADV
WRITE(8,2000)TLRPD,TMISC
WRITE(8,2001)TWQADV,TWQDIF
WRITE(8,2002)TWQKIN,TWQSED
WRITE(8,2003)CPUTIME(1),CPUTIME(2)
WRITE(8,2004)TIME_END,  TCPU

! **              EXACT FORMAT REQUIRED BY EFDC_EXPLORER
! *** TIME LOG
CALL TIMELOG(N,TIMEDAY)
WRITE(9,6995)THDMT,TCONG
IF( NSEDFLUME==0 )THEN
   WRITE(9,6996)TPUV,TSSED
ELSE
   WRITE(9,7005)TPUV,TSSEDZLJ
ENDIF
WRITE(9,6997)TCEXP,TAVB
WRITE(9,6998)TUVW, TQQQ
WRITE(9,6999)TVDIF,TSADV
WRITE(9,7000)TLRPD,TMISC
WRITE(9,7001)TWQADV,TWQDIF
WRITE(9,7002)TWQKIN,TWQSED
WRITE(9,7003)CPUTIME(1),CPUTIME(2)
WRITE(9,7004)TIME_END,  TCPU
6995 FORMAT('***TIMING (HOURS)',/, &
          'T HDMT       =',F14.4,'  T CONG GRAD  =',F14.4)
6996 FORMAT('T P&UV VELS  =',F14.4,'  T SSEDTOX    =',F14.4)
6997 FORMAT('T EXPLICIT   =',F14.4,'  T C VERT V&D =',F14.4)
6998 FORMAT('T CALC UVW   =',F14.4,'  T TURB QQQ   =',F14.4)
6999 FORMAT('T VERT DFUSN =',F14.4,'  T ADV TRANSP =',F14.4)
7000 FORMAT('T PART TRK   =',F14.4,'  T MISC TIME  =',F14.4)
7001 FORMAT('WQ ADV TRANS =',F14.4,'  WQ VERT DIFF =',F14.4)
7002 FORMAT('WQ KINETICS  =',F14.4,'  WQ DIAGEN    =',F14.4)
7003 FORMAT('CPU USER     =',F14.4,'  CPU SYSTEM   =',F14.4)
7004 FORMAT('ELAPSED TIME =',F14.4,'  CPU TIME     =',F14.4)
7005 FORMAT('T P&UV VELS  =',F14.4,'  T SEDZLJ     =',F14.4)
WRITE(9,'(i1)')1 ! GEOSR CHECK EFDC SUCCESS : JGCHO 2010.11.12
! *** EE END BLOCK

! **  CLOSE OUTPUT  FILES
CLOSE(7)
CLOSE(8)
CLOSE(9)


end subroutine model_end
